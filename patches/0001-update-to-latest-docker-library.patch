From fb291193d44d36d001c7aba9d7e3f65c3b7f0563 Mon Sep 17 00:00:00 2001
From: Aaron Friel <mayreply@aaronfriel.com>
Date: Mon, 6 Mar 2023 02:52:33 -0800
Subject: [PATCH 1/4] update to latest docker library

---
 internal/provider/provider.go                        | 6 +-----
 internal/provider/resource_docker_container_funcs.go | 6 +++++-
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/internal/provider/provider.go b/internal/provider/provider.go
index b52deab..7feca79 100644
--- a/internal/provider/provider.go
+++ b/internal/provider/provider.go
@@ -311,11 +311,7 @@ func providerSetToRegistryAuth(authList *schema.Set) (*AuthConfigs, error) {
 func loadConfigFile(configData io.Reader) (*configfile.ConfigFile, error) {
 	configFile := configfile.New("")
 	if err := configFile.LoadFromReader(configData); err != nil {
-		log.Println("[DEBUG] Error parsing registry config: ", err)
-		log.Println("[DEBUG] Will try parsing from legacy format")
-		if err := configFile.LegacyLoadFromReader(configData); err != nil {
-			return nil, err
-		}
+		return nil, err
 	}
 	return configFile, nil
 }
diff --git a/internal/provider/resource_docker_container_funcs.go b/internal/provider/resource_docker_container_funcs.go
index f51ce0c..9f902d4 100644
--- a/internal/provider/resource_docker_container_funcs.go
+++ b/internal/provider/resource_docker_container_funcs.go
@@ -11,6 +11,7 @@ import (
 	"fmt"
 	"io/ioutil"
 	"log"
+	"math"
 	"os"
 	"strings"
 	"time"
@@ -874,7 +875,10 @@ func resourceDockerContainerDelete(ctx context.Context, d *schema.ResourceData,
 		}
 
 		log.Printf("[INFO] Stopping Container '%s' with timeout %v", d.Id(), timeout)
-		if err := client.ContainerStop(ctx, d.Id(), &timeout); err != nil {
+		timeoutSecs := int(math.Ceil(timeout.Seconds()))
+		if err := client.ContainerStop(ctx, d.Id(), container.StopOptions{
+			Timeout: &timeoutSecs,
+		}); err != nil {
 			return diag.Errorf("Error stopping container %s: %s", d.Id(), err)
 		}
 	}
-- 
2.40.0

